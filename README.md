# Klopit - Веб-сервис Управления Проектами

**Klopit** - это веб-сервис с открытым исходным кодом, предназначенный для управления проектами и задачами. Он позволяет пользователям и небольшим командам организовывать работу, отслеживать прогресс, обмениваться файлами и комментариями в рамках проектов.


## Ключевые Возможности

*   **Аутентификация:** Регистрация, вход, выход, безопасное хранение паролей.
*   **Управление Профилем:** Просмотр, редактирование имени/email, смена пароля (с проверкой текущего).
*   **Роли Пользователей:** Базовые роли "User" и "Admin".
*   **Администрирование (для роли Admin):** Просмотр списка пользователей, редактирование их данных (имя, email, роль, статус активности), активация/деактивация.
*   **Управление Проектами:** Создание, просмотр списка доступных проектов (владелец или участник), редактирование (только владелец), удаление (только владелец).
*   **Участники Проекта:** Добавление/удаление участников проекта владельцем (по email). Участники имеют доступ к задачам, файлам, комментариям.
*   **Управление Задачами:** Создание, редактирование, удаление задач внутри проекта. Назначение исполнителей (из числа участников проекта), установка статусов (`К выполнению`, `В работе`, `Выполнено`, `В архиве`), приоритетов (`Низкий`, `Средний`, `Высокий`), сроков выполнения.
*   **Файлы:** Прикрепление файлов к задачам, скачивание, удаление файлов (владелец проекта или загрузивший). Проверка размера и типа файла.
*   **Комментарии:** Добавление комментариев к задачам, отображение истории комментариев.
*   **Уведомления:** Внутрисистемные уведомления о назначении задач, новых комментариях, добавлении в проект. Счетчик непрочитанных уведомлений.
*   **Отчеты:** Базовый отчет по проекту со статистикой задач по статусам и приоритетам, визуализация с помощью диаграмм (Chart.js).
*   **Адаптивный Дизайн:** Интерфейс разработан с использованием Bootstrap 5 и адаптирован для разных размеров экранов.

## Технологический Стек

*   **Backend:**
    *   Python 3
    *   Flask
    *   SQLAlchemy (Flask-SQLAlchemy)
    *   Alembic (Flask-Migrate)
    *   WTForms (Flask-WTF)
    *   Flask-Login
    *   Flask-Bcrypt
    *   Gunicorn (для развертывания)
*   **Frontend:**
    *   HTML5 / CSS3
    *   Bootstrap 5
    *   JavaScript
    *   Jinja2
    *   Chart.js
*   **База данных:**
    *   SQLite 
*   **Контроль версий:** Git

## Установка и Запуск (для Разработки)

1.  **Клонировать репозиторий:**
    ```bash
    git clone https://github.com/pwlgk/klopit
    cd klopit
    ```

2.  **Создать и активировать виртуальное окружение:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # Linux/macOS
    # или .\venv\Scripts\activate  # Windows PowerShell
    # или venv\Scripts\activate.bat # Windows CMD
    ```

3.  **Установить зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настроить конфигурацию:**
    *   Создайте файл `.env` в корневой папке проекта (скопируйте из `.env.example`, если он есть, или создайте новый).
    *   **Обязательно** задайте значение для `SECRET_KEY` (длинная случайная строка).
    *   Убедитесь, что `FLASK_APP=run.py` и `FLASK_ENV=development`.
    *   Проверьте или установите `DATABASE_URL`. Для SQLite используйте абсолютный путь, например:
        ```dotenv
        DATABASE_URL='sqlite:////полный/путь/к/вашему/проекту/klopit/app.db'
        ```
    *   Проверьте или установите `UPLOAD_FOLDER` (абсолютный путь).
    *   Опционально настройте `MAX_CONTENT_LENGTH` и `ALLOWED_EXTENSIONS`.

5.  **Создать/обновить базу данных:**
    ```bash
    flask db upgrade
    ```

6.  **Инициализировать роли в БД:**
    ```bash
    flask init-db
    ```

7.  **Запустить сервер разработки:**
    ```bash
    flask run
    ```

8.  Открыть приложение в браузере по адресу `http://127.0.0.1:5000` (или адресу, указанному в консоли).

## Создание Администратора

После первого запуска и регистрации пользователя:

1.  Активируйте виртуальное окружение (`source venv/bin/activate`).
2.  Выполните в терминале (заменив email):
    ```bash
    flask assign-admin ваш_зарегистрированный_email@example.com
    ```

## Развертывание (Deployment)

Подробные инструкции по развертыванию с использованием Nginx, Gunicorn, Systemd и PostgreSQL/SQLite находятся в отдельном файле или были предоставлены ранее. Основные шаги включают настройку сервера, базы данных, сервиса Systemd для Gunicorn и конфигурации Nginx в качестве обратного прокси, а также настройку HTTPS с Certbot.

## Структура Проекта

klopit/
├── app/ # Основной пакет приложения
│ ├── init.py # Фабрика приложения
│ ├── auth/ # Blueprint: Аутентификация
│ ├── cli.py # Команды CLI
│ ├── dashboard/ # Blueprint: Панель управления, Профиль, Админка
│ ├── extensions.py # Экземпляры расширений Flask
│ ├── files/ # Blueprint: Работа с файлами
│ ├── main/ # Blueprint: Главная страница
│ ├── models.py # Модели SQLAlchemy
│ ├── projects/ # Blueprint: Проекты и Задачи
│ ├── reports/ # Blueprint: Отчеты
│ ├── static/ # Статические файлы (CSS, JS, Images)
│ ├── templates/ # Шаблоны Jinja2 (включая includes/, email/)
│ └── utils/ # Утилиты (декораторы, уведомления)
├── migrations/ # Миграции Alembic
├── uploads/ # Папка для загруженных файлов (ВНЕ папки app)
├── venv/ # Виртуальное окружение
├── config.py # Конфигурация
├── run.py # Точка входа для flask run
├── requirements.txt # Зависимости Python
├── .env.example # Пример файла переменных окружения (создайте .env на его основе)
├── .gitignore # Исключения для Git
└── README.md # Этот файл